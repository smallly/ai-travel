<!--pages/index/index.wxml-->
<view class="trip-container">
  <!-- é¡µé¢å¤´éƒ¨ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„è¡Œç¨‹</text>
  </view>

  <!-- Tabåˆ‡æ¢ -->
  <view class="tab-container">
    <view class="tab-list">
      <view 
        class="tab-item {{currentTab === 'pending' ? 'active' : ''}}"
        data-tab="pending"
        bindtap="onTabChange"
      >
        <text class="tab-text">å¾…å‡ºè¡Œ</text>
      </view>
      <view 
        class="tab-item {{currentTab === 'planning' ? 'active' : ''}}"
        data-tab="planning" 
        bindtap="onTabChange"
      >
        <text class="tab-text">è§„åˆ’ä¸­</text>
      </view>
      <view 
        class="tab-item {{currentTab === 'completed' ? 'active' : ''}}"
        data-tab="completed"
        bindtap="onTabChange"
      >
        <text class="tab-text">å·²å®Œæˆ</text>
      </view>
    </view>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-container">
    <!-- å¾…å‡ºè¡Œé¡µé¢ -->
    <view class="tab-content" wx:if="{{currentTab === 'pending'}}">
      <!-- åœ°å›¾åŒºåŸŸ -->
      <view class="map-section {{isMapFullscreen ? 'fullscreen' : ''}}">
        <map
          id="tripMap"
          class="trip-map"
          latitude="{{mapCenter.latitude}}"
          longitude="{{mapCenter.longitude}}"
          scale="{{12}}"
          markers="{{mapMarkers}}"
          show-location="{{true}}"
          enable-3D="{{true}}"
          bindmarkertap="onMarkerTap"
          bindready="onMapReady"
        />
        
        <!-- åœ°å›¾æ§åˆ¶æŒ‰é’® -->
        <view class="map-controls">
          <button class="control-btn" bindtap="onToggleMapFullscreen">
            <text class="btn-icon">{{isMapFullscreen ? 'ğŸ“±' : 'ğŸ”'}}</text>
          </button>
          <button class="control-btn" bindtap="onMoveToUserLocation">
            <text class="btn-icon">ğŸ“</text>
          </button>
          <button class="control-btn" wx:if="{{mapMarkers.length > 0}}" bindtap="onIncludeAllPoints">
            <text class="btn-icon">ğŸ—ºï¸</text>
          </button>
        </view>

        <!-- å…¨å±æ—¶çš„è¿”å›æŒ‰é’® -->
        <view class="back-btn" wx:if="{{isMapFullscreen}}" bindtap="onToggleMapFullscreen">
          <text class="back-icon">â†</text>
        </view>
      </view>

      <!-- æˆ‘çš„åœ°ç‚¹åˆ—è¡¨ -->
      <view class="locations-section" wx:if="{{!isMapFullscreen}}">
        <view class="section-header">
          <text class="section-title">æˆ‘çš„æ—…è¡Œåœ°ç‚¹</text>
          <text class="location-count">{{myLocations.length}}ä¸ªåœ°ç‚¹</text>
        </view>

        <view class="locations-list" wx:if="{{myLocations.length > 0}}">
          <block wx:for="{{myLocations}}" wx:key="id">
            <view class="location-card" bindtap="showLocationActions" data-location="{{item}}">
              <image class="location-image" src="/images/default-location.jpg" mode="aspectFill" />
              <view class="location-info">
                <text class="location-name">{{item.name}}</text>
                <text class="location-address">{{item.address}}</text>
                <text class="location-time">ä¿å­˜äº {{item.savedDate}}</text>
              </view>
              <view class="location-actions">
                <button class="action-btn navigate-btn" data-location="{{item}}" bindtap="navigateToLocation">
                  <text class="action-icon">ğŸ§­</text>
                </button>
              </view>
            </view>
          </block>
        </view>

        <!-- ç©ºçŠ¶æ€ -->
        <view class="empty-state" wx:if="{{myLocations.length === 0}}">
          <text class="empty-icon">ğŸ“</text>
          <text class="empty-title">æš‚æ— æ—…è¡Œåœ°ç‚¹</text>
          <text class="empty-desc">å»å¯¹è¯é¡µé¢æ·»åŠ ä¸€äº›åœ°ç‚¹å§</text>
          <button class="empty-btn" bindtap="onCreateTrip">
            å¼€å§‹è§„åˆ’æ—…è¡Œ
          </button>
        </view>
      </view>
    </view>

    <!-- è§„åˆ’ä¸­é¡µé¢ -->
    <view class="tab-content" wx:if="{{currentTab === 'planning'}}">
      <view class="trip-list" wx:if="{{tripPlans.planning.length > 0}}">
        <block wx:for="{{tripPlans.planning}}" wx:key="id">
          <view class="trip-card" data-trip="{{item}}" bindtap="onViewTripDetail">
            <image class="trip-image" src="{{item.image || '/images/default-trip.jpg'}}" mode="aspectFill" />
            <view class="trip-info">
              <text class="trip-title">{{item.title}}</text>
              <text class="trip-meta">{{item.duration}} Â· {{item.locations}}ä¸ªåœ°ç‚¹</text>
              <text class="trip-date">åˆ›å»ºäº {{item.created_at}}</text>
            </view>
            <view class="trip-status planning">
              <text class="status-icon">ğŸ•</text>
            </view>
          </view>
        </block>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{tripPlans.planning.length === 0}}">
        <text class="empty-icon">ğŸ—“ï¸</text>
        <text class="empty-title">æš‚æ— è§„åˆ’ä¸­çš„è¡Œç¨‹</text>
        <text class="empty-desc">å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ—…è¡Œè®¡åˆ’</text>
        <button class="empty-btn" bindtap="onCreateTrip">
          åˆ›å»ºè¡Œç¨‹
        </button>
      </view>
    </view>

    <!-- å·²å®Œæˆé¡µé¢ -->
    <view class="tab-content" wx:if="{{currentTab === 'completed'}}">
      <view class="trip-list" wx:if="{{tripPlans.completed.length > 0}}">
        <block wx:for="{{tripPlans.completed}}" wx:key="id">
          <view class="trip-card" data-trip="{{item}}" bindtap="onViewTripDetail">
            <image class="trip-image" src="{{item.image || '/images/default-trip.jpg'}}" mode="aspectFill" />
            <view class="trip-info">
              <text class="trip-title">{{item.title}}</text>
              <text class="trip-meta">{{item.duration}} Â· {{item.locations}}ä¸ªåœ°ç‚¹</text>
              <text class="trip-date">{{item.start_date}} - {{item.end_date}}</text>
            </view>
            <view class="trip-status completed">
              <text class="status-icon">âœ…</text>
            </view>
          </view>
        </block>
      </view>

      <!-- ç©ºçŠ¶æ€ -->
      <view class="empty-state" wx:if="{{tripPlans.completed.length === 0}}">
        <text class="empty-icon">ğŸ“·</text>
        <text class="empty-title">æš‚æ— å·²å®Œæˆçš„è¡Œç¨‹</text>
        <text class="empty-desc">å®Œæˆçš„æ—…è¡Œä¼šå‡ºç°åœ¨è¿™é‡Œ</text>
      </view>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading-overlay" wx:if="{{loading}}">
    <view class="loading-content">
      <text class="loading-text">åŠ è½½ä¸­...</text>
    </view>
  </view>
</view>