<!--pages/chat/index.wxml-->
<view class="chat-container">
  <!-- èŠå¤©æ¶ˆæ¯åˆ—è¡¨ -->
  <scroll-view 
    class="messages-container" 
    scroll-y="{{true}}"
    scroll-into-view="{{scrollIntoView}}"
    scroll-top="{{scrollTop}}"
    bindscroll="onScroll"
    enhanced="{{true}}"
    show-scrollbar="{{false}}"
  >
    <view class="messages-list">
      <block wx:for="{{messages}}" wx:key="id">
        <view 
          class="message-item {{item.isAI ? 'ai-message' : 'user-message'}}"
          id="{{item.id}}"
        >
          <!-- æ—¶é—´æˆ³ -->
          <view class="message-time" wx:if="{{!item.isWelcome}}">
            {{item.timestamp}}
          </view>
          
          <!-- æ¶ˆæ¯æ°”æ³¡ -->
          <view class="message-bubble {{item.isAI ? 'ai-bubble' : 'user-bubble'}}">
            <text class="message-text">{{item.content}}</text>
          </view>
          
          <!-- æ™¯ç‚¹åˆ—è¡¨ -->
          <view class="attractions-container" wx:if="{{item.attractions && item.attractions.length > 0}}">
            <view class="attractions-header">
              <text class="attractions-title">å‘ç° {{item.attractions.length}} ä¸ªæ™¯ç‚¹</text>
              <button 
                class="add-all-btn" 
                size="mini"
                data-attractions="{{item.attractions}}"
                bindtap="onAddAllAttractions"
              >
                æ‰¹é‡æ·»åŠ 
              </button>
            </view>
            
            <view class="attractions-list">
              <block wx:for="{{item.attractions}}" wx:key="id" wx:for-item="attraction">
                <view class="attraction-card">
                  <image 
                    class="attraction-image" 
                    src="{{attraction.image}}" 
                    mode="aspectFill"
                    lazy-load="{{true}}"
                  />
                  <view class="attraction-info">
                    <text class="attraction-name">{{attraction.name}}</text>
                    <text class="attraction-address">{{attraction.address}}</text>
                    <view class="attraction-actions">
                      <button 
                        class="action-btn navigate-btn" 
                        size="mini"
                        data-attraction="{{attraction}}"
                        bindtap="onNavigateToAttraction"
                      >
                        å¯¼èˆª
                      </button>
                      <button 
                        class="action-btn add-btn" 
                        size="mini"
                        data-attraction="{{attraction}}"
                        bindtap="onAddAttraction"
                      >
                        æ·»åŠ 
                      </button>
                    </view>
                  </view>
                </view>
              </block>
            </view>
          </view>
        </view>
      </block>
      
      <!-- AIè¾“å…¥ä¸­çŠ¶æ€ -->
      <view class="message-item ai-message" wx:if="{{isTyping}}">
        <view class="message-bubble ai-bubble typing-bubble">
          <view class="typing-dots">
            <view class="dot"></view>
            <view class="dot"></view>
            <view class="dot"></view>
          </view>
        </view>
      </view>
    </view>
  </scroll-view>
  
  <!-- æ»šåŠ¨åˆ°åº•éƒ¨æŒ‰é’® -->
  <view class="scroll-to-bottom {{showScrollToBottom ? 'show' : ''}}" bindtap="onScrollToBottomTap">
    <text class="scroll-icon">â¬‡</text>
  </view>
  
  <!-- è¾“å…¥åŒºåŸŸ -->
  <view class="input-container">
    <view class="input-wrapper">
      <textarea 
        class="message-input"
        placeholder="å‘é€é“¾æ¥æˆ–å’¨è¯¢æ—…è¡Œé—®é¢˜..."
        value="{{inputValue}}"
        bindinput="onInputChange"
        maxlength="500"
        show-confirm-bar="{{false}}"
        adjust-position="{{true}}"
        auto-height="{{true}}"
        cursor-spacing="10"
      />
      <button 
        class="send-btn {{inputValue.length > 0 ? 'active' : ''}}"
        bindtap="onSendMessage"
        disabled="{{isTyping || inputValue.length === 0}}"
      >
        <text class="send-icon">ğŸ“¤</text>
      </button>
    </view>
    
    <!-- åŠŸèƒ½æŒ‰é’® -->
    <view class="function-buttons">
      <button class="function-btn" size="mini" bindtap="onClearChat">
        <text class="btn-icon">ğŸ—‘ï¸</text>
        <text class="btn-text">æ¸…ç©º</text>
      </button>
    </view>
  </view>
</view>